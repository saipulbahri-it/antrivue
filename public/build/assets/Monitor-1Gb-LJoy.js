import{u as U}from"./index-Bpvyb1TS.js";import{d as O,f as H,r as l,V as F,w as J,U as K,D as W,c as m,o as f,e as s,a as c,j as N,n as B,t as i,F as I,O as X,b as M,u as x}from"./app-BWNrNjCQ.js";import{A as Y}from"./ApplicationLogo-BY06AJv4.js";import{s as Z}from"./index-BVHhAzSW.js";import{s as ee}from"./index-Dk6ixdfn.js";import{s as te}from"./index-C89LGhrP.js";import{u as $}from"./index-D6OEKSfl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-a8w4ol-7.js";import"./index-D-cxfG7v.js";import"./index-DmKeCkvW.js";const ae={class:"px-2-py-2 flex flex-1 content-center items-center justify-center bg-gray-100 lg:h-screen"},se={key:0,class:"relative grid h-full w-full gap-6 p-5 lg:grid-cols-3 lg:gap-8"},le={class:"flex flex-1 flex-col items-start gap-6 overflow-hidden rounded-lg bg-white shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-gray-300 transition duration-300 hover:text-black/70 hover:ring-black/20 focus-visible:ring-[#FF2D20] md:row-span-3 dark:bg-zinc-900 dark:ring-zinc-800 dark:hover:text-white/70 dark:hover:ring-zinc-700 dark:focus-visible:ring-[#FF2D20]"},ne={class:"flex w-full items-center justify-between p-3 lg:p-6 lg:pb-6"},oe={class:"text-nowrap font-mono text-8xl font-bold text-green-800 transition"},ie={key:0,class:"text-5xl font-bold uppercase text-yellow-800"},re={class:"py-6-hidden text-2xl"},ue={class:"relative flex h-40 w-full flex-col items-center justify-center gap-6"},ce={id:"jam",class:"text-5xl font-bold"},de={id:"tanggal",class:"text-3xl font-bold"},ve={class:"flex items-start items-center"},me={class:"text-4xl font-bold"},fe={class:"font-mono text-8xl font-bold text-gray-800 transition"},pe={class:"items-end"},Ce=O({__name:"Monitor",props:{services:{},recentCalled:{}},setup(z){const A=H(),d=l(!0),v=l(null),p=l(z.recentCalled),b=l(""),_=l("");F(()=>{setInterval(()=>{const t=new Date;b.value=t.toLocaleTimeString("en",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),_.value=t.toLocaleDateString("id-ID")},1e3)});async function G(){try{const e=await(await fetch("/api/queue/next-call")).json();return e&&e.number&&e.counter?{number:e.number,counterName:e.counter.name,queueData:e}:null}catch(t){return console.error("Gagal fetch queue:",t),null}}const L=async()=>{const e=await(await fetch("/api/queue/recent-call")).json();p.value=e},y=l({});J(p,t=>{const e=t;e.forEach(a=>{const o=y.value[a.counter_name||""];a.queue_number&&a.queue_number!==o?(a.highlight=!0,setTimeout(()=>{a.highlight=!1},5e3)):a.highlight=!1,y.value[a.counter_name]=a.queue_number}),p.value=e});const h=l([]),w=l(null),r=l(!1),g=l(null);$(async()=>{if(!d.value){const t=await G();t&&h.value.push(t),await L()}},5e3),$(async()=>{if(!r.value&&h.value.length>0){const t=h.value.shift();t&&(v.value=t.queueData,await Q(t.number,t.counterName,t.queueData))}},2e3);async function Q(t,e,a){r.value=!0,w.value={number:t,counterName:e,queueData:a};try{await new Audio("sound/bell.mp3").play(),await new Promise(u=>setTimeout(u,500)),await R(t,e),setTimeout(()=>{w.value=null,r.value=!1},5e3)}catch(o){console.error("Gagal memanggil antrian:",o),A.add({severity:"error",summary:"Gagal memanggil antrian",detail:o,life:3e3}),r.value=!1}}const E=K([]),k=l(void 0);let D;F(()=>{setTimeout(()=>{D=window.speechSynthesis;const t=()=>{const e=D.getVoices();e.length>0?(E.value=e,g.value=e.find(a=>a.lang==="id-ID"&&a.name.includes("Google"))||null,k.value=g.value||void 0):setTimeout(t,500)};t(),speechSynthesis.onvoiceschanged=t})});const q=l(""),{speak:P}=U(q,{voice:k,lang:"id-ID",rate:.95});function R(t,e){return new Promise((a,o)=>{try{q.value=`Nomor antrian ${t}, silakan menuju ${e}`,P(),a()}catch(u){o(u)}})}return(t,e)=>{var o,u,j,C,T,S;const a=W("Button");return f(),m(I,null,[s("div",ae,[d.value?N("",!0):(f(),m("div",se,[s("div",le,[s("div",ne,[c(Y),c(a,{class:"ml-auto",icon:"pi pi-volume-up",severity:r.value?"success":"secondary",raised:"",rounded:"","aria-label":"volume"},null,8,["severity"])]),s("div",{class:B(["queue-display relative flex w-full flex-1 flex-col justify-evenly gap-5 bg-gray-100 py-5 text-center",[{"animate-pulse":r.value,"bg-green-100":r.value,"border-5":r.value,"border-green-500":r.value}]])},[e[2]||(e[2]=s("div",{class:"text-5xl font-bold uppercase text-yellow-800"}," Nomor Antrian ",-1)),s("div",oe,i(((o=v.value)==null?void 0:o.number)||"-"),1),(j=(u=v.value)==null?void 0:u.counter)!=null&&j.name?(f(),m("div",ie,[s("div",null,"Menuju "+i((T=(C=v.value)==null?void 0:C.counter)==null?void 0:T.name),1),s("div",re,i(((S=v.value)==null?void 0:S.service.name)||""),1)])):N("",!0)],2),s("div",ue,[s("div",ce,i(b.value),1),s("div",de,i(_.value),1)])]),(f(!0),m(I,null,X(p.value,n=>(f(),m("div",{key:n.counter_id,class:B(["queue-display flex flex-1 flex-col justify-around rounded-xl bg-white p-6 shadow-lg",[{highlight:n.highlight}]])},[s("div",ve,[s("h2",me,i(n.counter_name||"-"),1)]),s("div",fe,i(n.queue_number||"-"),1),s("div",pe,i(n.service_name),1)],2))),128))]))]),c(x(Z),{class:"fixed bottom-1 right-1 flex gap-2 text-sm"},{default:M(()=>{var n,V;return[e[3]||(e[3]=s("i",{class:"pi pi-volume-up"},null,-1)),s("i",null,i((n=g.value)==null?void 0:n.name)+" - "+i((V=g.value)==null?void 0:V.lang),1)]}),_:1}),c(x(ee),{position:"bottom-left"}),c(x(te),{header:"Tampilkan Monitor",visible:d.value,"onUpdate:visible":e[1]||(e[1]=n=>d.value=n),closable:!1,draggable:!1,modal:!0},{default:M(()=>[c(a,{label:"Submit",class:"p-button-success w-full",onClick:e[0]||(e[0]=n=>d.value=!1)})]),_:1},8,["visible"])],64)}}});export{Ce as default};
