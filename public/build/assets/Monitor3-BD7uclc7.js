import{d as q,f as C,r,V as N,c as d,o as f,e as u,a as g,j as B,t as i,b as G,u as y,F as _,O as I}from"./app-I_EO46gW.js";import{s as M}from"./index-ekTKN4D7.js";import{s as j}from"./index-Dz7WN_FH.js";import{u as b}from"./index-v5uf1LwW.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-C0sk7RJL.js";import"./index-wugWXVqD.js";const D={class:"queue-caller"},F={key:0,class:"queue-display"},Q={class:"number"},T={class:"counter"},$=q({__name:"Monitor3",setup(P){const v=C(),c=r([]),o=r(null),m=r(!1),h=r([]),l=r(null),w=r();N(()=>{const e=()=>{h.value=speechSynthesis.getVoices(),l.value=h.value.find(t=>t.lang==="id-ID"&&t.name.includes("Google"))||null};speechSynthesis.getVoices().length===0?speechSynthesis.onvoiceschanged=e:e(),console.log(l.value)}),b(async()=>{const e=await x();e&&c.value.push(e)},5e3),b(async()=>{if(!m.value&&c.value.length>0){const e=c.value.shift();e&&await S(e.number,e.counter)}},2e3);async function x(){try{const t=await(await fetch("/api/queue/next-call")).json();return t&&t.number&&t.counter?{number:t.number,counter:t.counter.name}:null}catch(e){return console.error("Gagal fetch queue:",e),null}}const V=new Audio("sound/bell.mp3");async function S(e,t){m.value=!0,o.value={number:e,counter:t};try{await V.play(),await new Promise(a=>setTimeout(a,500)),await k(e,t),v.add({summary:o.value.number,life:3e3}),setTimeout(()=>{o.value=null,m.value=!1},4e3)}catch(a){console.error("Gagal memanggil antrian:",a),v.add({severity:"error",summary:"Gagal memanggil antrian",detail:a,life:3e3}),m.value=!1}}function k(e,t){return new Promise((a,s)=>{try{const p=`Nomor antrean ${e}, silakan menuju ${t}`,n=new SpeechSynthesisUtterance(p);n.lang="id-ID",n.rate=.95,l.value&&(n.voice=l.value,console.log(n.voice)),n.onend=()=>a(),n.onerror=s,speechSynthesis.cancel(),speechSynthesis.speak(n)}catch(p){s(p)}})}return(e,t)=>(f(),d(_,null,[u("div",D,[o.value?(f(),d("div",F,[u("div",Q,i(o.value.number),1),u("div",T,"Menuju "+i(o.value.counter),1)])):B("",!0),g(y(M),{class:"fixed bottom-1 right-1 flex gap-2 text-sm"},{default:G(()=>{var a,s;return[t[0]||(t[0]=u("i",{class:"pi pi-volume-up"},null,-1)),u("i",null,i((a=l.value)==null?void 0:a.name)+" - "+i((s=l.value)==null?void 0:s.lang),1)]}),_:1}),(f(!0),d(_,null,I(c.value,(a,s)=>(f(),d("div",{key:s},i(a),1))),128)),u("audio",{ref_key:"bellAudio",ref:w,src:"/sound/bell.mp3",controls:"",class:"fixed bottom-0 left-0"},null,512)]),g(y(j),{position:"bottom-left"})],64))}}),K=A($,[["__scopeId","data-v-03c4274c"]]);export{K as default};
