import{A as B}from"./ApplicationLogo-BY06AJv4.js";import{u as q}from"./index-Bpvyb1TS.js";import{d as z,r as p,V as y,w as S,D as A,c as v,o as g,e,a as k,n as E,u as f,t as a,F as I,O as L}from"./app-BWNrNjCQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D6OEKSfl.js";const M={class:"px-2-py-2 flex h-screen flex-1 content-center items-center justify-center bg-gray-100"},P={class:"relative grid h-full w-full gap-6 p-5 lg:grid-cols-3 lg:gap-8"},T={class:"flex flex-col items-start gap-6 overflow-hidden rounded-lg bg-white p-6 shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-white/[0.05] transition duration-300 hover:text-black/70 hover:ring-black/20 focus:outline-none focus-visible:ring-[#FF2D20] md:row-span-3 lg:p-10 lg:pb-10 dark:bg-zinc-900 dark:ring-zinc-800 dark:hover:text-white/70 dark:hover:ring-zinc-700 dark:focus-visible:ring-[#FF2D20]"},$={class:"flex pb-5"},G={class:"flex items-center justify-between gap-2"},O={class:"text-5xl font-bold text-yellow-500"},R={class:"font-mono text-9xl font-bold text-green-800 transition"},U={class:"flex items-center gap-2"},H={class:"text-2xl font-bold"},J={header:""},K={class:"flex items-center gap-2"},Q={class:"text-4xl font-bold"},W={class:"flex-end"},X={class:"font-mono text-8xl font-bold text-gray-800 transition"},Y={footer:""},le=z({__name:"Monitor-copy",props:{services:{},counters:{}},setup(C){const r=p(null),_=p([]),c=p(!1);y(()=>{m(),setInterval(m,1e4)});const m=async()=>{await F(),await j()},F=async()=>{console.log("start:checkForNewCall");const t=await(await fetch("/api/queue/next-call")).json();t&&t.id&&(r.value=t,c.value=!0,console.log("start:playVoice"),await V(t.number,t.counter.name),console.log("end:playVoice"),c.value=!1),console.log("end:checkForNewCall")},j=async()=>{const t=await(await fetch("/api/queue/recent-call")).json();_.value=t};S(_,o=>{C.counters.forEach(t=>{const s=o.find(l=>{var i;return((i=l.counter)==null?void 0:i.id)===(t==null?void 0:t.id)});s&&(t.last_queue_called={...s,status:s.status||"",counter_id:s.counter.id,service_id:s.service.id})})});const h=p(""),{speak:D,isPlaying:n,status:d,stop:N}=q(h,{lang:"id-ID",rate:.95});async function V(o,t){try{return h.value=`Nomor antrean ${o}, silakan menuju ${t}`,N(),new Promise(s=>{D();const l=()=>{console.log(d.value,n.value),!n.value&&(d==null?void 0:d.value)=="end"?s():setTimeout(l,100)};l()})}catch(s){throw console.error("Gagal play voice:",s),s}}return y(()=>{}),(o,t)=>{var l,i,x,w;const s=A("Button");return g(),v("div",M,[e("div",P,[e("div",T,[e("div",$,[e("div",null,[k(B)])]),e("div",{class:E(["border-primary-500 relative flex w-full flex-1 flex-col justify-between rounded-3xl border p-5",[{"animate-pulse":c.value,"bg-green-100":f(n),"border-5":f(n),"border-green-500":f(n)}]])},[e("i",null,a(c.value),1),e("div",G,[e("h2",O,a((i=(l=r.value)==null?void 0:l.counter)==null?void 0:i.name),1),k(s,{icon:"pi pi-volume-up",severity:f(n)?"success":"secondary",raised:"",rounded:"","aria-label":"volume"},null,8,["severity"])]),e("p",R,a((x=r.value)==null?void 0:x.number),1),e("div",U,[e("h2",H,a((w=r.value)==null?void 0:w.service.name),1)])],2),t[0]||(t[0]=e("div",{class:"relative flex flex-col items-center gap-6 lg:items-end"},null,-1))]),(g(!0),v(I,null,L(o.counters,u=>{var b;return g(),v("div",{key:u.id,class:"flex flex-col items-center justify-around rounded-xl bg-white p-6 shadow-lg"},[e("div",J,[e("div",K,[e("h2",Q,a(u.name),1)])]),e("div",W,[e("div",X,a(((b=u.last_queue_called)==null?void 0:b.number)||"-"),1)]),e("div",Y,[e("div",null,a(u.service.name),1)])])}),128))])])}}});export{le as default};
